<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon - Вход</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header">
        <h1 class="header-title">войти в neon</h1>
        <a href="index.html" class="logo">Ne</a>
    </div>

    <div class="login-container">
        <div class="panel login-panel" id="login-form">
            <h2 id="heading">Войти</h2>
            <form id="form" novalidate>
                <div class="form-group">
                    <input type="email" id="email" placeholder="email" required>
                </div>
                <div class="form-group hidden" id="login-group">
                    <input type="text" id="login" placeholder="логин (имя пользователя)">
                </div>
                <div class="form-group">
                    <input type="password" id="pass" placeholder="пароль" required>
                </div>
                <button type="submit" class="neon-button" id="btn">Войти</button>
            </form>
            <p style="margin-top:40px; font-size:1.1rem;">
                <span id="toggle-text">Нет аккаунта?</span>
                <a href="#" id="toggle" style="color:var(--neon); font-weight:600; text-decoration:none;">Зарегистрируйтесь!</a>
            </p>
        </div>

        <!-- Красивое окно после регистрации -->
        <div class="panel success-panel hidden" id="success-box">
            <h2>Спасибо за регистрацию!</h2>
            <p>Спасибо за регистрацию на <strong>Neon</strong>!</p>
            <p>Пожалуйста, перейдите по проверочной ссылке из письма, отправленного на вашу почту: <span class="email" id="reg-email"></span></p>
            <p>Если вы не видите письма — проверьте папку «Спам».</p>
            <p>Также приложения Neon доступны почти на всех устройствах.</p>
            <button class="neon-button" onclick="location.href='index.html'">Понятно</button>
        </div>
    </div>

    <script>
        const URL = 'https://zamhgvmayjcyvdkuauxe.supabase.co';
        const KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InphbWhndm1heWpjeYZka3VhdXhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4Nzc4ODksImV4cCI6MjA3OTQ1Mzg4OX0.8wEp6oRH7XcZtc-4kZaIBNZWnLfmUEe23BNpaFoi7_o';

        let isLogin = true;
        const form = document.getElementById('form');
        const loginBox = document.getElementById('login-form');
        const successBox = document.getElementById('success-box');

        document.getElementById('toggle').onclick = e => {
            e.preventDefault();
            isLogin = !isLogin;
            document.getElementById('heading').textContent = isLogin ? 'Войти' : 'Регистрация';
            document.getElementById('btn').textContent = isLogin ? 'Войти' : 'Зарегистрироваться';
            document.getElementById('toggle').textContent = isLogin ? 'Зарегистрируйтесь!' : 'Войти!';
            document.getElementById('toggle-text').textContent = isLogin ? 'Нет аккаунта?' : 'Уже есть аккаунт?';
            document.getElementById('login-group').classList.toggle('hidden');
        };

        form.onsubmit = async e => {
            e.preventDefault();
            const email = document.getElementById('email').value.trim();
            const pass = document.getElementById('pass').value;
            const login = document.getElementById('login').value.trim();

            document.getElementById('btn').disabled = true;

            try {
                if (isLogin) {
                    const r = await fetch(URL + '/auth/v1/token?grant_type=password', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', apikey: KEY },
                        body: JSON.stringify({ email, password: pass })
                    });
                    const d = await r.json();
                    if (d.access_token) {
                        localStorage.setItem('neon_token', d.access_token);
                        location.href = 'index.html';
                    } else {
                        alert('Неверный email или пароль');
                    }
                } else {
                    await fetch(URL + '/auth/v1/signup', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', apikey: KEY },
                        body: JSON.stringify({ email, password: pass, data: { username: login } })
                    });
                    document.getElementById('reg-email').textContent = email;
                    loginBox.classList.add('hidden');
                    successBox.classList.remove('hidden');
                }
            } catch {
                alert('Ошибка сети');
            }
            document.getElementById('btn').disabled = false;
        };
    </script>
</body>
</html>